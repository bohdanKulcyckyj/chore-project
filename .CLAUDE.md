# CLAUDE.md - AI Assistant Context

This document provides context for AI assistants working with the Household Duties Manager codebase.

## Project Overview

A gamified household task management application that helps families/roommates manage chores through points, achievements, and competition. Built with React + TypeScript frontend and Supabase backend.

## Architecture & Key Technologies

### Frontend Stack
- **React 18** with TypeScript for type safety
- **Vite** for development/building (fast HMR)
- **Tailwind CSS** for utility-first styling
- **Framer Motion** for animations
- **React Router DOM** for client-side routing
- **Lucide React** for consistent iconography
- **React Hot Toast** for notifications

### Backend Stack
- **Supabase** provides:
  - PostgreSQL database
  - Authentication (email/password)
  - Real-time subscriptions
  - Row Level Security (RLS)
  - File storage (for future proof uploads)

## Development Workflow

### Essential Commands
```bash
npm run dev      # Start development server on http://localhost:5173
npm run build    # Build for production
npm run lint     # Run ESLint checks
npm run preview  # Preview production build
```

### Environment Setup
Required `.env` variables:
```
VITE_SUPABASE_URL=<supabase_project_url>
VITE_SUPABASE_ANON_KEY=<supabase_anon_key>
```

## Code Organization Patterns

### Component Structure
- Components are organized by feature domain in `src/components/`
- Each component uses TypeScript interfaces for props
- Animations use Framer Motion with staggered delays
- Tailwind classes for styling (no separate CSS files)

### State Management
- **Authentication**: Context provider at `src/hooks/useAuth.tsx`
- **Household Data**: Context provider at `src/hooks/useHousehold.tsx`
- **Local State**: useState for component-specific state
- **Server State**: Direct Supabase queries with real-time subscriptions

### Data Flow
1. User actions trigger Supabase operations
2. Supabase handles auth, data persistence, and RLS
3. React contexts provide global state
4. Components subscribe to relevant data changes
5. UI updates reactively

## Database Schema Key Points

### Core Tables
- `households` - Household entities with invite codes
- `household_members` - User-household relationships (admin/member roles)
- `tasks` - Task definitions with recurrence patterns
- `task_assignments` - Maps tasks to users with due dates
- `task_completions` - Records completion details and approvals
- `user_points` - Gamification stats per user per household
- `achievements` - Achievement definitions
- `user_achievements` - Tracks earned achievements
- `notifications` - User notifications

### Security Model
- Row Level Security (RLS) enabled on ALL tables
- Users can only access data from their households
- Admins have elevated permissions within their household
- No direct database access - all through Supabase client

## Common Development Tasks

### Adding a New Feature
1. Define TypeScript types in `src/types/database.ts`
2. Create component in appropriate folder under `src/components/`
3. Add Supabase queries using the client from `src/lib/supabase.ts`
4. Implement RLS policies if new tables are added
5. Update relevant hooks if global state is needed

### Working with Supabase
```typescript
// Import the configured client
import { supabase, Tables } from '../lib/supabase';

// Type-safe table types
type Task = Tables<'tasks'>;

// Query example
const { data, error } = await supabase
  .from('tasks')
  .select('*')
  .eq('household_id', householdId);
```

### Adding Animations
Use Framer Motion with consistent patterns:
```typescript
<motion.div
  initial={{ opacity: 0, y: 20 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ delay: 0.1 }}
>
```

## Current Implementation Status

### ‚úÖ Completed
- User authentication (signup/signin/signout)
- Household creation and joining via invite code
- Basic dashboard with stats cards
- Database schema with all tables
- RLS security policies
- Type definitions for database

### üöß In Progress
- Task management UI (viewing only, no CRUD yet)
- Calendar view (placeholder)
- Leaderboard view (placeholder)
- Settings pages (placeholder)

### ‚ùå Not Implemented
- Task creation/editing/deletion
- Task completion workflow
- Approval system for tasks
- Actual achievement tracking
- Notification system
- Task recurrence engine
- Photo proof uploads
- Dark mode

## Important Files

- `src/App.tsx` - Main app component with routing logic
- `src/hooks/useAuth.tsx` - Authentication context and methods
- `src/hooks/useHousehold.tsx` - Household management context
- `src/lib/supabase.ts` - Supabase client configuration
- `src/types/database.ts` - TypeScript database types
- `supabase/migrations/*.sql` - Database schema and RLS policies

## Code Style Guidelines

### TypeScript
- Use explicit types for function parameters and return values
- Define interfaces for component props
- Use type imports from database.ts for Supabase data

### React Patterns
- Functional components with hooks
- Custom hooks for reusable logic
- Context for global state
- Error boundaries for error handling

### Styling
- Tailwind utility classes only
- Consistent spacing scale (p-4, p-6, etc.)
- Gradient patterns: `from-[color]-500 to-[color]-600`
- Rounded corners: `rounded-xl` or `rounded-2xl`
- Shadows: `shadow-lg` for cards

### Component Conventions
- Loading states with skeleton screens
- Error handling with toast notifications
- Consistent icon usage from Lucide React
- Motion animations for better UX

## Common Issues & Solutions

### Auth Issues
- Check Supabase Auth settings in dashboard
- Verify email confirmation is disabled for development
- Ensure RLS policies allow authenticated users

### Data Not Showing
- Check RLS policies for the table
- Verify user is member of household
- Check for loading states in components

### Type Errors
- Run `npm run lint` to check TypeScript
- Ensure database.ts types match schema
- Use proper type assertions for Supabase responses

## Testing Approach
Currently no test suite implemented. When adding tests:
- Unit tests for utility functions
- Integration tests for hooks
- E2E tests for critical user flows
- Mock Supabase client for testing

## Deployment Considerations
- Build with `npm run build`
- Set production environment variables
- Enable Supabase email confirmation for production
- Configure proper CORS settings
- Set up monitoring for database performance

## Performance Optimizations
- Lazy load route components
- Implement virtualization for long lists
- Use React.memo for expensive components
- Batch Supabase queries when possible
- Cache frequently accessed data

## Future Architecture Decisions
- Consider adding Zustand for complex client state
- Implement React Query for server state caching
- Add error boundary components
- Create shared component library
- Implement comprehensive logging

## Task Execution Workflow for LLMs

When given a development task, follow this structured approach:

### 1. Task Analysis & Planning
- Break down the task into small, manageable pieces
- Create a session document in `ai/sessions/` named: `[taskname-session-yyyy-mm-dd-sessionCounter].md`
- Document the breakdown with clear subtasks

### 2. Present Plan to User
Present a detailed plan including:
- Task understanding and objectives
- Breakdown of subtasks with dependencies
- Technical approach for each piece
- Estimated complexity and risks
- Files that will be modified/created
- Wait for user acknowledgement before proceeding

### 3. Incremental Implementation
After receiving acknowledgement:
- Implement each piece incrementally
- Test each piece before moving to the next
- Commit logical chunks of work
- Keep the user informed of progress
- Ask for clarification when needed

### 4. Session Documentation
In the session file, maintain:
- [ ] Task checklist with progress
- Technical decisions made
- Problems encountered and solutions
- Code snippets for reference
- Testing notes

### Example Session Structure
```markdown
# Task: Add Task Creation Form
Date: 2024-01-15
Session: 001

## Objective
Implement a form for creating new tasks in the household

## Subtasks
- [ ] Create TaskForm component
- [ ] Add form validation
- [ ] Integrate with Supabase
- [ ] Add to dashboard
- [ ] Test functionality

## Implementation Notes
[Document progress here]
```

### Best Practices
- Always understand the existing codebase patterns first
- Maintain backwards compatibility
- Follow the established conventions
- Test incrementally
- Document significant decisions
- Ask for clarification rather than making assumptions

## Helpful Context for AI Assistants

When helping with this codebase:
1. Always check existing patterns before suggesting new approaches
2. Maintain TypeScript type safety
3. Follow the established Tailwind styling patterns
4. Ensure new features respect the RLS security model
5. Consider mobile responsiveness for all UI changes
6. Use the existing animation patterns with Framer Motion
7. Reference the initial_build_app_prompt.md for original requirements